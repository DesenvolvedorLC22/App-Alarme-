<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relógio Digital</title>
    <!-- Incluindo Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- CORREÇÃO: Usando apenas as fontes Inter e Roboto Mono -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Roboto+Mono:wght@500&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* CORREÇÃO: Classe de fonte única para todos os visores */
        .display-font {
            font-family: 'Roboto Mono', monospace;
        }
        .alarm-active-bg { animation: pulse-bg 1.5s infinite; }
        @keyframes pulse-bg {
            0%, 100% { background-color: #dc2626; } /* red-600 */
            50% { background-color: #f87171; } /* red-400 */
        }
        .alarm-item-ringing {
            background-color: #b91c1c !important; /* red-700 */
            animation: pulse-item 1s infinite;
        }
        @keyframes pulse-item {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        .tab-btn.active {
            background-color: #0e7490; /* cyan-700 */
            color: white;
        }
        .tab-btn {
            background-color: #374151; /* gray-700 */
        }
        .panel { display: none; }
        .panel.active { display: block; }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen transition-colors duration-500">

    <div class="w-full max-w-lg mx-auto bg-gray-800 rounded-2xl shadow-2xl p-4 sm:p-6 text-center">
        
        <!-- CORREÇÃO: Aplicando a classe de fonte padronizada -->
        <div id="clock" class="display-font text-5xl sm:text-6xl font-bold my-4 tracking-wider text-white bg-gray-900/50 rounded-lg py-4">
            00:00:00
        </div>

        <!-- Abas de Navegação -->
        <div class="flex justify-center border-b border-gray-700 mb-4">
            <button id="tabAlarm" class="tab-btn flex-1 py-2 px-4 font-semibold rounded-t-lg transition">Alarme</button>
            <button id="tabTimer" class="tab-btn flex-1 py-2 px-4 font-semibold rounded-t-lg transition">Temporizador</button>
            <button id="tabStopwatch" class="tab-btn flex-1 py-2 px-4 font-semibold rounded-t-lg transition">Cronômetro</button>
        </div>

        <!-- Painel de Alarme -->
        <div id="panelAlarm" class="panel">
            <div class="space-y-4 bg-gray-700/50 p-4 rounded-lg">
                <h2 class="text-xl font-semibold text-white">Adicionar Novo Alarme</h2>
                <input type="time" id="alarmTime" class="bg-gray-700 border-2 border-gray-600 text-white text-xl rounded-lg p-2.5 w-full">
                <input type="file" id="alarmSound" accept=".mp3,audio/mpeg" class="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-cyan-50 file:text-cyan-700 hover:file:bg-cyan-100 cursor-pointer">
                <button id="addAlarmBtn" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 rounded-lg text-lg transition">Adicionar</button>
            </div>
            <div class="mt-4">
                <h3 class="text-lg font-semibold text-gray-300 mb-2" id="alarmsListTitle" style="display: none;">Alarmes Ativos:</h3>
                <ul id="alarmsList" class="space-y-2 max-h-40 overflow-y-auto"></ul>
            </div>
        </div>

        <!-- Painel de Temporizador -->
        <div id="panelTimer" class="panel">
            <div class="space-y-4 bg-gray-700/50 p-4 rounded-lg">
                <h2 class="text-xl font-semibold text-white">Temporizador</h2>
                <!-- CORREÇÃO: Aplicando a classe de fonte padronizada -->
                <div id="timerDisplay" class="display-font text-6xl font-bold text-white py-4">00:00:00</div>
                <div class="flex justify-center gap-2 sm:gap-4">
                    <input type="number" id="timerHours" placeholder="HH" min="0" max="99" class="w-1/3 bg-gray-700 border-2 border-gray-600 text-white text-center rounded-lg p-2">
                    <input type="number" id="timerMinutes" placeholder="MM" min="0" max="59" class="w-1/3 bg-gray-700 border-2 border-gray-600 text-white text-center rounded-lg p-2">
                    <input type="number" id="timerSeconds" placeholder="SS" min="0" max="59" class="w-1/3 bg-gray-700 border-2 border-gray-600 text-white text-center rounded-lg p-2">
                </div>
                 <div class="grid grid-cols-3 gap-2 sm:gap-4">
                    <button id="startTimerBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 rounded-lg transition">Iniciar</button>
                    <button id="pauseTimerBtn" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 rounded-lg transition">Pausar</button>
                    <button id="resetTimerBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 rounded-lg transition">Resetar</button>
                </div>
            </div>
        </div>

        <!-- Painel de Cronômetro -->
        <div id="panelStopwatch" class="panel">
             <div class="space-y-4 bg-gray-700/50 p-4 rounded-lg">
                <h2 class="text-xl font-semibold text-white">Cronômetro</h2>
                <!-- CORREÇÃO: Aplicando a classe de fonte padronizada -->
                <div id="stopwatchDisplay" class="display-font text-6xl font-bold text-white py-4">00:00:00.00</div>
                 <div class="grid grid-cols-3 gap-2 sm:gap-4">
                    <button id="startStopwatchBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 rounded-lg transition">Iniciar</button>
                    <button id="stopStopwatchBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 rounded-lg transition">Parar</button>
                    <button id="resetStopwatchBtn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 rounded-lg transition">Resetar</button>
                </div>
                <div class="mt-2">
                    <button id="lapStopwatchBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-lg transition">Volta</button>
                    <ul id="lapsList" class="text-left mt-2 space-y-1 max-h-28 overflow-y-auto"></ul>
                </div>
            </div>
        </div>

    </div>

    <script>
    // --- ELEMENTOS GLOBAIS ---
    const clockElement = document.getElementById('clock');
    const bodyElement = document.body;
    const tabs = {
        alarm: document.getElementById('tabAlarm'),
        timer: document.getElementById('tabTimer'),
        stopwatch: document.getElementById('tabStopwatch'),
    };
    const panels = {
        alarm: document.getElementById('panelAlarm'),
        timer: document.getElementById('panelTimer'),
        stopwatch: document.getElementById('panelStopwatch'),
    };

    let audioContext;
    
    // --- LÓGICA DE ABAS ---
    function switchTab(tabName) {
        Object.keys(tabs).forEach(key => {
            const isSelected = key === tabName;
            tabs[key].classList.toggle('active', isSelected);
            panels[key].classList.toggle('active', isSelected);
        });
    }
    tabs.alarm.addEventListener('click', () => switchTab('alarm'));
    tabs.timer.addEventListener('click', () => switchTab('timer'));
    tabs.stopwatch.addEventListener('click', () => switchTab('stopwatch'));

    // --- LÓGICA DO RELÓGIO PRINCIPAL ---
    function updateClock() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        const currentTime = `${hours}:${minutes}`;
        
        clockElement.textContent = `${hours}:${minutes}:${seconds}`;

        // Verifica alarmes
        alarms.forEach(alarm => {
            if (alarm.time === currentTime && !alarm.isRinging) {
                triggerAlarm(alarm);
            }
        });
    }

    // --- LÓGICA DE ALARME ---
    const alarmTimeInput = document.getElementById('alarmTime');
    const alarmSoundInput = document.getElementById('alarmSound');
    const addAlarmBtn = document.getElementById('addAlarmBtn');
    const alarmsList = document.getElementById('alarmsList');
    const alarmsListTitle = document.getElementById('alarmsListTitle');
    let alarms = [];
    const activeBeeps = {};

    function addAlarm() {
        if (!alarmTimeInput.value) { alert('Defina um horário.'); return; }
        const soundFile = alarmSoundInput.files[0];
        alarms.push({
            id: Date.now(),
            time: alarmTimeInput.value,
            soundFile: soundFile,
            soundURL: soundFile ? URL.createObjectURL(soundFile) : null,
            isRinging: false
        });
        renderAlarms();
        alarmTimeInput.value = "";
        alarmSoundInput.value = "";
    }

    function removeAlarm(id) {
        const alarm = alarms.find(a => a.id === id);
        if (!alarm) return;
        stopAlarmSound(alarm);
        if (alarm.soundURL) URL.revokeObjectURL(alarm.soundURL);
        alarms = alarms.filter(a => a.id !== id);
        renderAlarms();
        if (!alarms.some(a => a.isRinging) && !isTimerRinging) {
            bodyElement.classList.remove('alarm-active-bg');
        }
    }

    function triggerAlarm(alarm) {
        alarm.isRinging = true;
        bodyElement.classList.add('alarm-active-bg');
        playAlarmSound(alarm);
        renderAlarms();
    }

    function renderAlarms() {
        alarmsList.innerHTML = '';
        alarmsListTitle.style.display = alarms.length > 0 ? 'block' : 'none';
        alarms.forEach(alarm => {
            const li = document.createElement('li');
            li.className = `flex items-center justify-between p-2 rounded-lg bg-gray-700 ${alarm.isRinging ? 'alarm-item-ringing' : ''}`;
            const soundName = alarm.soundFile ? alarm.soundFile.name : 'Som Padrão';
            li.innerHTML = `
                <div class="text-left"><span class="font-bold">${alarm.time}</span><span class="block text-xs text-gray-400 truncate max-w-[150px]">${soundName}</span></div>
                <button class="remove-btn bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded-lg">${alarm.isRinging ? 'Parar' : 'Remover'}</button>`;
            li.querySelector('.remove-btn').addEventListener('click', () => removeAlarm(alarm.id));
            alarmsList.appendChild(li);
        });
    }
    addAlarmBtn.addEventListener('click', addAlarm);

    // --- LÓGICA DO TEMPORIZADOR ---
    const timerDisplay = document.getElementById('timerDisplay');
    const [timerHours, timerMinutes, timerSeconds] = [document.getElementById('timerHours'), document.getElementById('timerMinutes'), document.getElementById('timerSeconds')];
    const [startTimerBtn, pauseTimerBtn, resetTimerBtn] = [document.getElementById('startTimerBtn'), document.getElementById('pauseTimerBtn'), document.getElementById('resetTimerBtn')];
    
    let timerInterval;
    let timerTotalSeconds = 0;
    let isTimerRunning = false;
    let isTimerRinging = false;
    let timerAudio;

    function updateTimerDisplay() {
        const h = Math.floor(timerTotalSeconds / 3600);
        const m = Math.floor((timerTotalSeconds % 3600) / 60);
        const s = timerTotalSeconds % 60;
        timerDisplay.textContent = `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
    }

    function startTimer() {
        if (isTimerRunning) return;
        const h = parseInt(timerHours.value) || 0;
        const m = parseInt(timerMinutes.value) || 0;
        const s = parseInt(timerSeconds.value) || 0;
        if (timerTotalSeconds === 0) {
            timerTotalSeconds = h * 3600 + m * 60 + s;
        }
        if (timerTotalSeconds <= 0) return;

        isTimerRunning = true;
        timerInterval = setInterval(() => {
            timerTotalSeconds--;
            updateTimerDisplay();
            if (timerTotalSeconds <= 0) {
                clearInterval(timerInterval);
                isTimerRunning = false;
                isTimerRinging = true;
                bodyElement.classList.add('alarm-active-bg');
                timerAudio = playDefaultBeep(); // Timer always plays default beep
            }
        }, 1000);
    }

    function pauseTimer() {
        isTimerRunning = false;
        clearInterval(timerInterval);
    }

    function resetTimer() {
        clearInterval(timerInterval);
        isTimerRunning = false;
        isTimerRinging = false;
        timerTotalSeconds = 0;
        timerHours.value = ''; timerMinutes.value = ''; timerSeconds.value = '';
        updateTimerDisplay();
        bodyElement.classList.remove('alarm-active-bg');
        if (timerAudio) stopDefaultBeep(timerAudio);
    }

    startTimerBtn.addEventListener('click', startTimer);
    pauseTimerBtn.addEventListener('click', pauseTimer);
    resetTimerBtn.addEventListener('click', resetTimer);

    // --- LÓGICA DO CRONÔMETRO ---
    const stopwatchDisplay = document.getElementById('stopwatchDisplay');
    const [startStopwatchBtn, stopStopwatchBtn, resetStopwatchBtn, lapStopwatchBtn] = [document.getElementById('startStopwatchBtn'), document.getElementById('stopStopwatchBtn'), document.getElementById('resetStopwatchBtn'), document.getElementById('lapStopwatchBtn')];
    const lapsList = document.getElementById('lapsList');
    
    let stopwatchInterval;
    let stopwatchStartTime;
    let stopwatchElapsedTime = 0;
    let isStopwatchRunning = false;
    let lapCounter = 0;

    function formatTime(ms) {
        const date = new Date(ms);
        const minutes = String(date.getUTCMinutes()).padStart(2, '0');
        const seconds = String(date.getUTCSeconds()).padStart(2, '0');
        const milliseconds = String(Math.floor(date.getUTCMilliseconds() / 10)).padStart(2, '0');
        return `${minutes}:${seconds}.${milliseconds}`;
    }

    function updateStopwatch() {
        const now = Date.now();
        stopwatchElapsedTime = now - stopwatchStartTime;
        stopwatchDisplay.textContent = formatTime(stopwatchElapsedTime);
    }

    function startStopwatch() {
        if (isStopwatchRunning) return;
        isStopwatchRunning = true;
        stopwatchStartTime = Date.now() - stopwatchElapsedTime;
        stopwatchInterval = setInterval(updateStopwatch, 10);
    }

    function stopStopwatch() {
        isStopwatchRunning = false;
        clearInterval(stopwatchInterval);
    }

    function resetStopwatch() {
        stopStopwatch();
        stopwatchElapsedTime = 0;
        stopwatchDisplay.textContent = "00:00:00.00";
        lapsList.innerHTML = '';
        lapCounter = 0;
    }

    function lapStopwatch() {
        if (!isStopwatchRunning) return;
        lapCounter++;
        const li = document.createElement('li');
        li.className = "p-1 bg-gray-600/50 rounded";
        li.textContent = `Volta ${lapCounter}: ${formatTime(stopwatchElapsedTime)}`;
        lapsList.prepend(li);
    }



    startStopwatchBtn.addEventListener('click', startStopwatch);
    stopStopwatchBtn.addEventListener('click', stopStopwatch);
    resetStopwatchBtn.addEventListener('click', resetStopwatch);
    lapStopwatchBtn.addEventListener('click', lapStopwatch);

    // --- FUNÇÕES DE ÁUDIO ---
    function initAudioContext() {
        if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }

    function playAlarmSound(alarm) {
        initAudioContext();
        if (alarm.soundURL) {
            const audio = new Audio(alarm.soundURL);
            audio.loop = true;
            audio.play().catch(e => console.error(e));
            alarm.audioElement = audio;
        } else {
            activeBeeps[alarm.id] = playDefaultBeep();
        }
    }
    
    function stopAlarmSound(alarm) {
        if (alarm.audioElement) {
            alarm.audioElement.pause();
            alarm.audioElement.src = '';
        }
        if (activeBeeps[alarm.id]) {
            stopDefaultBeep(activeBeeps[alarm.id]);
            delete activeBeeps[alarm.id];
        }
        alarm.isRinging = false;
    }

    function playDefaultBeep() {
        initAudioContext();
        const gainNode = audioContext.createGain();
        gainNode.connect(audioContext.destination);
        const oscillator = audioContext.createOscillator();
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(880, audioContext.currentTime);
        oscillator.connect(gainNode);
        oscillator.start();
        const interval = setInterval(() => {
            gainNode.gain.cancelScheduledValues(audioContext.currentTime);
            gainNode.gain.setValueAtTime(gainNode.gain.value, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(1, audioContext.currentTime + 0.1);
            gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.5);
        }, 600);
        return { oscillator, gainNode, interval };
    }

    function stopDefaultBeep(beep) {
        if (!beep) return;
        clearInterval(beep.interval);
        beep.oscillator.stop();
        beep.oscillator.disconnect();
        beep.gainNode.disconnect();
    }

    // --- INICIALIZAÇÃO ---
    window.onload = () => {
        updateClock();
        setInterval(updateClock, 1000);
        switchTab('alarm'); // Inicia na aba de alarme
    };
    </script>
</body>
</html>
